(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3dc730e8"],{"293a":function(e,t,n){"use strict";n.r(t);n("b0c0");var a=n("7a23"),s={class:"\r\n        py-4\r\n        col-xxl-7 col-xl-7 col-lg-8 col-md-9 col-sm-10 col-12\r\n        mx-auto\r\n      "},c={class:"d-none d-sm-block"},r={class:"row min-height-80vh bg-white"},i={class:"col-xxl-4 col-xl-4 col-lg-4 col-md-4 col-sm-4 padding-none border"},l={class:"d-flex justify-content-center align-items-center border-bottom h-65px"},u={class:"fs-4"},o={key:0,class:"d-flex flex-column"},d={class:"position-relative"},b=Object(a["h"])("div",null,null,-1),h={class:"ms-2"},O={class:""},j={key:0,class:"last-message"},v={key:1,class:"last-message"},m={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"100%",width:"100%"}},g=Object(a["h"])("div",{class:"spinner-border text-primary mx-auto my-auto",role:"status"},[Object(a["h"])("span",{class:"visually-hidden"},"Loading...")],-1),p={class:"col-xxl-8 col-xl-8 col-lg-8 col-md-8 col-sm-8 padding-none border-top border-end border-bottom"},f={key:0,class:"chat-window"},x={class:"fs-4"},y={key:0,id:"messageBox"},w={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"calc(80vh - 127px)",width:"100%"}},k=Object(a["h"])("div",{class:"spinner-border text-primary mx-auto my-auto",role:"status"},[Object(a["h"])("span",{class:"visually-hidden"},"Loading...")],-1),U={class:"chat-form"},I={key:1,class:"h-100 d-flex justify-content-center align-items-center"},B=Object(a["h"])("div",{class:"text-center"},[Object(a["h"])("div",{class:"mb-2"},[Object(a["h"])("i",{class:"fab fa-3x fa-facebook-messenger"})]),Object(a["h"])("h2",null,"你的訊息"),Object(a["h"])("span",null,"傳送訊息給朋友")],-1),S={class:"flex d-block d-sm-none"},E={class:"row min-height-80vh bg-white xs"},H={key:0,class:"chat-window"},F={class:"fs-4"},M={key:0,id:"messageBox"},R={key:1,class:"",style:{height:"calc(80vh - 127px)"}},T=Object(a["h"])("div",{class:"spinner-border text-primary",role:"status"},[Object(a["h"])("span",{class:"visually-hidden"},"Loading...")],-1),L={class:"chat-form"},N={key:1,class:"padding-none border friends-box bg-white"},C={class:"d-flex justify-content-center align-items-center border h-65px"},A={class:"fs-4"},D={class:"d-flex flex-column"},J={class:"position-relative"},K=Object(a["h"])("div",null,null,-1),G={class:"ms-2"},P={class:""},V={key:0,class:"last-message"},_={key:1,class:"last-message"};function z(e,t){var n=Object(a["z"])("router-link");return Object(a["r"])(),Object(a["d"])("div",s,[Object(a["h"])("div",c,[Object(a["h"])("div",r,[Object(a["h"])("aside",i,[Object(a["h"])("div",l,[Object(a["h"])("span",u,Object(a["B"])(e.currentUser.name),1)]),e.isFetchFriendsLoading?(Object(a["r"])(),Object(a["d"])("div",m,[g])):(Object(a["r"])(),Object(a["d"])("div",o,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["y"])(e.friends,(function(e){return Object(a["r"])(),Object(a["d"])(n,{class:"chat-user",key:e.id,to:{name:"chat-with-user",params:{chattingUserId:e.id}}},{default:Object(a["G"])((function(){return[Object(a["h"])("div",null,[Object(a["h"])("div",d,[Object(a["h"])("img",{src:e.avatar,alt:"avatar",class:"avatar"},null,8,["src"]),Object(a["h"])("div",{class:e.isOnline?"online":"offline"},[b],2)]),Object(a["h"])("div",h,[Object(a["h"])("span",O,Object(a["B"])(e.name),1),e.lastMessage?(Object(a["r"])(),Object(a["d"])("span",j,Object(a["B"])(e.lastMessage),1)):(Object(a["r"])(),Object(a["d"])("span",v," 尚無聊天訊息 "))])])]})),_:2},1032,["to"])})),128))]))]),Object(a["h"])("div",p,[e.isChatUser?(Object(a["r"])(),Object(a["d"])("div",f,[Object(a["h"])("div",null,[Object(a["h"])("span",x,Object(a["B"])(e.chattingUser.name),1)]),Object(a["h"])("div",null,[e.isFetchMessagesLoading?(Object(a["r"])(),Object(a["d"])("div",w,[k])):(Object(a["r"])(),Object(a["d"])("div",y,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["y"])(e.messages,(function(t){return Object(a["r"])(),Object(a["d"])("div",{key:t.id,class:t.class},[Object(a["h"])("div",null,["received"===t.class?(Object(a["r"])(),Object(a["d"])("img",{key:0,src:e.chattingUser.avatar,alt:"avatar"},null,8,["src"])):Object(a["e"])("",!0),Object(a["h"])("span",null,Object(a["B"])(t.message),1)])],2)})),128))]))]),Object(a["h"])("div",U,[Object(a["h"])("form",{action:"POST",onSubmit:t[4]||(t[4]=Object(a["I"])((function(){return e.handleSubmit&&e.handleSubmit.apply(e,arguments)}),["prevent"]))},[Object(a["H"])(Object(a["h"])("textarea",{placeholder:"訊息......","onUpdate:modelValue":t[1]||(t[1]=function(t){return e.message=t}),onKeypress:t[2]||(t[2]=function(){return e.submitOnEnter&&e.submitOnEnter.apply(e,arguments)}),onInput:t[3]||(t[3]=function(){return e.updateTextareaHeight&&e.updateTextareaHeight.apply(e,arguments)}),class:"textarea",rows:"1"},null,544),[[a["D"],e.message]])],32)])])):(Object(a["r"])(),Object(a["d"])("div",I,[B]))])])]),Object(a["h"])("div",S,[Object(a["h"])("div",E,[e.isChatUser?(Object(a["r"])(),Object(a["d"])("div",H,[Object(a["h"])("div",null,[Object(a["h"])("span",F,Object(a["B"])(e.chattingUser.name),1)]),Object(a["h"])("div",null,[e.isFetchMessagesLoading?(Object(a["r"])(),Object(a["d"])("div",R,[T])):(Object(a["r"])(),Object(a["d"])("div",M,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["y"])(e.messages,(function(t){return Object(a["r"])(),Object(a["d"])("div",{key:t.id,class:t.class},[Object(a["h"])("div",null,["received"===t.class?(Object(a["r"])(),Object(a["d"])("img",{key:0,src:e.chattingUser.avatar,alt:"avatar"},null,8,["src"])):Object(a["e"])("",!0),Object(a["h"])("span",null,Object(a["B"])(t.message),1)])],2)})),128))]))]),Object(a["h"])("div",L,[Object(a["h"])("form",{action:"POST",onSubmit:t[8]||(t[8]=Object(a["I"])((function(){return e.handleSubmit&&e.handleSubmit.apply(e,arguments)}),["prevent"]))},[Object(a["H"])(Object(a["h"])("textarea",{placeholder:"訊息......","onUpdate:modelValue":t[5]||(t[5]=function(t){return e.message=t}),onKeypress:t[6]||(t[6]=function(){return e.submitOnEnter&&e.submitOnEnter.apply(e,arguments)}),onInput:t[7]||(t[7]=function(){return e.updateTextareaHeight&&e.updateTextareaHeight.apply(e,arguments)}),class:"textarea",rows:"1"},null,544),[[a["D"],e.message]])],32)])])):(Object(a["r"])(),Object(a["d"])("aside",N,[Object(a["h"])("div",C,[Object(a["h"])("span",A,Object(a["B"])(e.currentUser.name),1)]),Object(a["h"])("div",D,[(Object(a["r"])(!0),Object(a["d"])(a["a"],null,Object(a["y"])(e.friends,(function(e){return Object(a["r"])(),Object(a["d"])(n,{class:"chat-user",key:e.id,to:{name:"chat-with-user",params:{chattingUserId:e.id}}},{default:Object(a["G"])((function(){return[Object(a["h"])("div",null,[Object(a["h"])("div",J,[Object(a["h"])("img",{src:e.avatar,alt:"avatar",class:"avatar"},null,8,["src"]),Object(a["h"])("div",{class:e.isOnline?"online":"offline"},[K],2)]),Object(a["h"])("div",G,[Object(a["h"])("span",P,Object(a["B"])(e.name),1),e.lastMessage?(Object(a["r"])(),Object(a["d"])("span",V,Object(a["B"])(e.lastMessage),1)):(Object(a["r"])(),Object(a["d"])("span",_," 尚無聊天訊息 "))])])]})),_:2},1032,["to"])})),128))])]))])])])}var W=n("1da1"),q=n("5530"),Q=(n("96cf"),n("d81d"),n("caad"),n("2532"),n("a9e3"),n("7db0"),n("498a"),n("5502")),X=n("6c02"),Y=n("2fa3"),Z=n("4cce"),$={getMessages:function(e){var t=e.chattingUserId;return Y["c"].get("/messages/".concat(t))}},ee={name:"Chat",setup:function(){var e=Object(a["x"])(!1),t=Object(a["x"])(!1),n=Object(X["e"])(),s=n.params.id,c=Object(a["b"])((function(){return n.params.chattingUserId})),r=Object(a["b"])((function(){return!!c.value})),i=Object(a["x"])([]),l=Object(a["x"])([]),u=Object(a["x"])([]),o=function(e){i.value=i.value.map((function(t){return t.id!==e.senderId&&t.id!==e.receiverId||(t.lastMessage=e.message),t}))},d=function(){var e=document.getElementById("messageBox"),t=document.getElementById("messageBox2");null!==e&&(e.scrollTop=e.scrollHeight),null!==t&&(t.scrollTop=t.scrollHeight)},b=function(e){l.value=e},h=function(e){i.value=i.value.map((function(t){return Object(q["a"])(Object(q["a"])({},t),{},{isOnline:e.includes(t.id)})}))},O=function(){var e=Object(W["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u.value.push(t),e.next=3,Object(a["m"])();case 3:d();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(W["a"])(regeneratorRuntime.mark((function e(){var n,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.value=!0,e.next=4,$.getMessages({chattingUserId:c.value});case 4:n=e.sent,a=n.data,u.value=a.messages,t.value=!1,e.next=15;break;case 10:e.prev=10,e.t0=e["catch"](0),t.value=!1,Y["b"].fire({icon:"error",title:"無法取得聊天紀錄，請稍後再試"}),console.log("Error: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}(),v=function(){var t=Object(W["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e.value=!0,t.next=4,Z["a"].getFriends({userId:s});case 4:n=t.sent,a=n.data,l.value.length&&(a=a.map((function(e){return Object(q["a"])(Object(q["a"])({},e),{},{isOnline:l.value.includes(e.id)})}))),i.value=a,e.value=!1,t.next=16;break;case 11:t.prev=11,t.t0=t["catch"](0),e.value=!1,Y["b"].fire({icon:"error",title:"無法取得好友列表，請稍後再試"}),console.log("Error: ",t.t0);case 16:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}(),m=Object(a["x"])({}),g=Object(Q["c"])(),p="wss://simple-twitter-project-api.herokuapp.com/",f=Object(a["x"])({}),x=function(e){f.value=new WebSocket(p+"?chattingUserId="+e,g.state.token),f.value.onopen=function(){},f.value.onclose=function(){},f.value.onmessage=function(t){var n=JSON.parse(t.data);n.onlineUsersId&&b(n.onlineUsersId),n.message&&(Number(n.message.senderId)!==Number(e)&&Number(n.message.receiverId)!==Number(e)||(n.message.class=n.status?"sent":"received",n.message.messageStatus="success"===n.status,O(n.message)),o(n.message))}},y=function(e){f.value.send(e)};Object(a["F"])(c,function(){var e=Object(W["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("undefined"!==t&&t){e.next=5;break}m.value={},l.value=[],e.next=13;break;case 5:if(n=i.value.find((function(e){return e.id===Number(t)})),m.value=Object.assign({},n),!r.value){e.next=13;break}return x(c.value),v(),e.next=12,j();case 12:d();case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(a["F"])(l,(function(e){h(e)}));var w=Object(a["x"])(""),k=function(){w.value.trim()&&(y(String(w.value)),w.value="")};return Object(X["d"])((function(){f.value.readyState&&f.value.close()})),Object(X["c"])((function(){f.value.readyState&&f.value.close()})),Object(a["p"])(Object(W["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return v(),e.next=3,j();case 3:d(),r.value&&x(c.value);case 5:case"end":return e.stop()}}),e)})))),{isFetchMessagesLoading:t,isFetchFriendsLoading:e,friends:i,messages:u,isChatUser:r,chattingUserId:c,chattingUser:m,message:w,handleSubmit:k,ws:f,wsSend:y,onlineUsersId:l}},methods:{updateTextareaHeight:function(){var e=document.getElementsByClassName("textarea"),t=[e[0].style.height.substring(0,e[0].style.height.length-2),e[1].style.height.substring(0,e[1].style.height.length-2)];console.log(t),e[0].style.height="auto",e[0].style.height=e[0].scrollHeight+"px",e[1].style.height="auto",e[1].style.height=e[1].scrollHeight+"px"},submitOnEnter:function(e){13!==e.which||e.shiftKey||(e.target.form.dispatchEvent(new Event("submit",{cancelable:!0})),e.preventDefault())}},computed:Object(q["a"])({},Object(Q["b"])(["currentUser","isAuthenticated","token"]))};n("aecd");ee.render=z;t["default"]=ee},"7db0":function(e,t,n){"use strict";var a=n("23e7"),s=n("b727").find,c=n("44d2"),r="find",i=!0;r in[]&&Array(1)[r]((function(){i=!1})),a({target:"Array",proto:!0,forced:i},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),c(r)},aecd:function(e,t,n){"use strict";n("be1c")},be1c:function(e,t,n){}}]);
//# sourceMappingURL=chunk-3dc730e8.5c6e0f81.js.map